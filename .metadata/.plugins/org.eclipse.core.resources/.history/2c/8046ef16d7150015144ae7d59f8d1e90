angular.module('preview', ['ngRoute'])
 

.config(function($routeProvider) {
  $routeProvider
    .when('/', {      
      templateUrl:'views/preview.html',
      controller:'PreviewCtrl'
    })
    .when('/get/:formid/:verformid', {      
      templateUrl:'views/preview.html',
      controller:'PreviewCtrl'
    })
    .otherwise({
      redirectTo:'/'
    });
})

.controller('PreviewCtrl', function($scope, $routeParams, $http) {
	
	var formid 			= $routeParams.formid;
	var verformid		= $routeParams.verformid;
	var panel 			= $("#ppal");
	
	//$scope.data = [];	
	
	var sURL  = 'http://hgmsapdev01.hgm.com:8000/sap/bc/ibmformwizard/forms_data/forms?formid=' + formid + '&verformid=' + verformid;
		
	$http.get( sURL ).
		success(function(list){
			list 		= list[0];
			$scope.data = list;
			
			
			// Recorro las secciones
			angular.forEach(list.versions[0].sections, function(section){				
				
				// Agrego la seccion al panel
				var elmsection = '<div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">'+section.sectiontitle+'</h3></div><div class="panel-body" id="'+list.formid + section.sectionid+'"></div></div>';
  				panel.append(elmsection);
  				
  				// Agrego los campos
  				angular.forEach(section.fields, function(field){
  					

  					// Elemento padre osea la seccion
  					var nameelmparent = list.formid + section.sectionid;
  					var elm = $('#'+nameelmparent);

  					// Evaluo que tipo de elemento es
  					switch(field.fieldtype) {
					    case 'TEXT':
					        addInput(elm,field,list.formid,section);
					        break;
					    case 'RADIO':
					        addRadio(elm,field,list.formid,section);
					        break;
					    case 'CHECK':
					        addCheck(elm,field,list.formid,section);
					        break;
					    case 'COMBO':
					        addCombo(elm,field,list.formid,section);
					        break;
					    default:
					        addInput(elm,field,list.formid,section);
					}  					

  				})
				
			})		
			
			
		});

	
})